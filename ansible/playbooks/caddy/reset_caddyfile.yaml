---
# Playbook to reset Caddyfile to a clean state
# This removes the old Caddyfile and prepares for fresh configuration
- name: Reset Caddyfile on Caddy hosts
  hosts: caddy
  become: true

  tasks:
    - name: Backup existing Caddyfile
      copy:
        src: /etc/caddy/Caddyfile
        dest: "/etc/caddy/Caddyfile.backup.{{ ansible_date_time.iso8601_basic_short }}"
        remote_src: true
      ignore_errors: true

    - name: Clear Caddyfile
      copy:
        content: ""
        dest: /etc/caddy/Caddyfile
        owner: root
        group: root
        mode: '0644'

    - name: Stop Caddy service temporarily
      systemd:
        name: caddy
        state: stopped

    - name: Display reset status
      debug:
        msg: "Caddyfile has been cleared on {{ inventory_hostname }}. Backup saved to /etc/caddy/Caddyfile.backup.*"
